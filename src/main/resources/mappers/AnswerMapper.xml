<!-- src/main/resources/mappers/AnswerMapper.xml -->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="practical.llm.answer.mapper.AnswerMapper">

    <!-- tb_answer.answer_text(JSON) 에 "문자열로 된 JSON"을 그대로 저장 -->
    <insert id="insertAnswer"
            parameterType="practical.llm.answer.domain.Answer"
            useGeneratedKeys="true"
            keyProperty="a.answerId">
        INSERT INTO tb_answer
            (question_id, answer_text)
        VALUES
            (
                #{a.questionId},
                CAST(#{a.answerText} AS JSON)
            )
    </insert>

    <select id="findLatestQuestionIdByDocumentId" resultType="long">
        SELECT q.question_id
        FROM tb_question q
        WHERE q.document_id = #{documentId}
        ORDER BY q.created_at DESC
            LIMIT 1
    </select>

</mapper>